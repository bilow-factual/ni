#!/bin/bash
rm -f ni ni-boot
cat src/{core,prefix,fn,gen,gentypes,io}.pl \
    src/{data,datatypes,iotypes,iobind,iofns}.pl \
    src/{ops,optypes,main}.pl \
    > ni-debug

perl -ne '$i |= /^\s*DEBUG$/; print unless $i; $i &= !/^\s*DEBUG_END$/' \
  < ni-debug \
  | egrep -v '^\s*(#(\s.+)?)?$' \
  > ni-boot

sed -ri '2,3d; /^\s*DEBUG(_END)?/d' ni-debug

chmod +x ni-boot ni-debug \
  && ./ni-boot --self > ni \
  && chmod +x ni
